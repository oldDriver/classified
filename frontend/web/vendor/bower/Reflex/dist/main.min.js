/*! reflex - v0.7.79 - 2015-10-05
* https://github.com/lu4/reflex
* Copyright (c) 2015 Denis Yaremov; Licensed MIT */
var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},Reflex;!function(a){function b(a){return a}function c(a,b){throw new Error("Element with key '"+b+"' was already added into the tree")}function d(a,b){a.value=b}function e(a,b){var c=b.left,d=b.right;a.balance=b.balance,a.key=b.key,a.value=b.value,a.left=c,a.right=d,null!==c&&(c.parent=a),null!==d&&(d.parent=a)}function f(a,b,c,d,e,f){if(null!==b)for(;;)if(a(c,b.key)<0){if(!b.left)return d(b);b=b.left}else{if(!a(c,b.key))return f(b);if(!b.right)return e(b);b=b.right}return null}function g(a,b,c){if(null!==a){if(null!==a[c]){for(a=a[c];null!==a[b];)a=a[b];return a}for(;null!==a.parent;){var d=a;if(a=a.parent,a[b]===d)return a}}return null}function h(a,b,c,d){if(null!==a){var e,f,g=d(a);for(null===a[c]?e=!1:(e=!0,f=a[c]);void 0===g;)if(e){for(a=f;null!==a[b];)a=a[b];f=a[c],g=d(a),e=null!==f}else{if(null===a.parent)break;var h=a;a=a.parent,a[b]===h&&(f=a[c],g=d(a),e=null!==f)}return g}return null}function i(a,b,c){if(null===this.root){var d={balance:0,key:a,value:b,left:null,right:null,parent:null};return this.root=d,this.count=this.count+1,d}for(var d=this.root;null!==d;){var e=this.comparer(a,d.key);if(0>e){var f=d.left;if(null===f){var g=d.left={balance:0,key:a,value:b,left:null,right:null,parent:d};return k.call(this,d,1),this.count=this.count+1,g}d=f}else{if(!(e>0))return c(d,b),d;var h=d.right;if(null===h){var g=d.right={balance:0,key:a,value:b,left:null,right:null,parent:d};return k.call(this,d,-1),this.count=this.count+1,g}d=h}}}function j(a,b,c){if(null===this.root){var d={balance:0,key:a,value:b(),left:null,right:null,parent:null};return this.root=d,this.count=this.count+1,d}for(var d=this.root;null!==d;){var e=this.comparer(a,d.key);if(0>e){var f=d.left;if(null===f){var g=d.left={balance:0,key:a,value:b(),left:null,right:null,parent:d};return k.call(this,d,1),this.count=this.count+1,g}d=f}else{if(!(e>0))return c(d,b),d;var h=d.right;if(null===h){var g=d.right={balance:0,key:a,value:b(),left:null,right:null,parent:d};return k.call(this,d,-1),this.count=this.count+1,g}d=h}}}function k(a,b){for(;null!==a&&(b=a.balance+=b,0!==b);){if(2===b){1===a.left.balance?n.call(this,a):o.call(this,a);break}if(-2===b){-1===a.right.balance?m.call(this,a):p.call(this,a);break}var c=a.parent;null!==c&&(b=c.left===a?1:-1),a=c}}function l(a,b){for(;null!==a;){if(b=a.balance+=b,2===b)if(a.left.balance>=0){if(a=n.call(this,a),-1===a.balance)break}else a=o.call(this,a);else if(-2===b)if(a.right.balance<=0){if(a=m.call(this,a),1===a.balance)break}else a=p.call(this,a);else if(0!==b)break;var c=a.parent;null!==c&&(b=c.left===a?-1:1),a=c}}function m(a){var b=a.right,c=b.left,d=a.parent;return b.parent=d,b.left=a,a.right=c,a.parent=b,null!==c&&(c.parent=a),a===this.root?this.root=b:d.right===a?d.right=b:d.left=b,b.balance++,a.balance=-b.balance,b}function n(a){var b=a.left,c=b.right,d=a.parent;return b.parent=d,b.right=a,a.left=c,a.parent=b,null!==c&&(c.parent=a),a===this.root?this.root=b:d.left===a?d.left=b:d.right=b,b.balance--,a.balance=-b.balance,b}function o(a){var b=a.left,c=b.right,d=a.parent,e=c.right,f=c.left;return c.parent=d,a.left=e,b.right=f,c.left=b,c.right=a,b.parent=c,a.parent=c,null!==e&&(e.parent=a),null!==f&&(f.parent=b),a===this.root?this.root=c:d.left===a?d.left=c:d.right=c,-1===c.balance?(a.balance=0,b.balance=1):0===c.balance?(a.balance=0,b.balance=0):(a.balance=-1,b.balance=0),c.balance=0,c}function p(a){var b=a.right,c=b.left,d=a.parent,e=c.left,f=c.right;return c.parent=d,a.right=e,b.left=f,c.right=b,c.left=a,b.parent=c,a.parent=c,null!==e&&(e.parent=a),null!==f&&(f.parent=b),a===this.root?this.root=c:d.right===a?d.right=c:d.left=c,1===c.balance?(a.balance=0,b.balance=-1):0===c.balance?(a.balance=0,b.balance=0):(a.balance=1,b.balance=0),c.balance=0,c}var q=function(){function a(a){this.count=0,this.root=null,this.comparer=a}return a.prototype.remove=function(a){for(var b=this.root;null!==b;)if(this.comparer(a,b.key)<0)b=b.left;else{if(this.comparer(a,b.key)<=0){var c=b.left,d=b.right;if(null===c)if(null===d)if(b===this.root)this.root=null;else{var f=b.parent;f.left===b?(f.left=null,l.call(this,f,-1)):(f.right=null,l.call(this,f,1))}else e(b,d),l.call(this,b,0);else if(null===d)e(b,c),l.call(this,b,0);else{var g=d;if(null===g.left){var f=b.parent;g.parent=f,g.left=c,g.balance=b.balance,c.parent=g,b===this.root?this.root=g:f.left===b?f.left=g:f.right=g,l.call(this,g,1)}else{for(;null!==g.left;)g=g.left;var f=b.parent,h=g.parent,i=g.right;h.left===g?h.left=i:h.right=i,null!==i&&(i.parent=h),g.parent=f,g.left=c,g.balance=b.balance,g.right=d,d.parent=g,c.parent=g,b===this.root?this.root=g:f.left===b?f.left=g:f.right=g,l.call(this,h,-1)}}return b.value}b=b.right}return null},a.prototype.find=function(a){var b=this.root,c=this.comparer;if(null!==b)for(;;)if(c(a,b.key)<0){if(!b.left)return null;b=b.left}else{if(!c(a,b.key))return b;if(!b.right)return null;b=b.right}return null},a.prototype.min=function(){for(var a=this.root;null!==a.left;)a=a.left;return a},a.prototype.max=function(){for(var a=this.root;null!==a.right;)a=a.right;return a},a.prototype.next=function(a){return g(a,"left","right")},a.prototype.prev=function(a){return g(a,"right","left")},a.prototype.findNext=function(a){return f(this.comparer,this.root,a,b,this.next,this.next)},a.prototype.findPrev=function(a){return f(this.comparer,this.root,a,this.prev,b,this.prev)},a.prototype.findCurrOrNext=function(a){return f(this.comparer,this.root,a,b,this.next,b)},a.prototype.findCurrOrPrev=function(a){return f(this.comparer,this.root,a,this.prev,b,b)},a.prototype.iterateForward=function(a,b){return h(a,"left","right",b)},a.prototype.iterateReverse=function(a,b){return h(a,"right","left",b)},a.prototype.add=function(a,b){return i.call(this,a,b,c)},a.prototype.put=function(a,b){return i.call(this,a,b,d)},a.prototype.getOrAdd=function(a,c){return i.call(this,a,c,b).value},a.prototype.getOrAddLazy=function(a,c){return j.call(this,a,c,b).value},a.prototype.clear=function(){this.root=null,this.count=0},a.prototype.toList=function(){var a=[];return this.iterateForward(this.min(),function(b){a.push({key:b.key,value:b.value})}),a},a}();a.AvlTree=q}(Reflex||(Reflex={}));var Reflex;!function(a){var b;!function(a){var b;!function(a){var b={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},c={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},d="[^aeiou]",e="[aeiouy]",f=d+"[^aeiouy]*",g=e+"[aeiou]*",h="^("+f+")?"+g+f,i="^("+f+")?"+g+f+"("+g+")?$",j="^("+f+")?"+g+f+g+f,k="^("+f+")?"+e;a.Stemmer=function(a){var d,g,l,m,n,o,p;if(a.length<3)return a;if(l=a.substr(0,1),"y"==l&&(a=l.toUpperCase()+a.substr(1)),m=/^(.+?)(ss|i)es$/,n=/^(.+?)([^s])s$/,m.test(a)?a=a.replace(m,"$1$2"):n.test(a)&&(a=a.replace(n,"$1$2")),m=/^(.+?)eed$/,n=/^(.+?)(ed|ing)$/,m.test(a)){var q=m.exec(a);m=new RegExp(h),m.test(q[1])&&(m=/.$/,a=a.replace(m,""))}else if(n.test(a)){var q=n.exec(a);d=q[1],n=new RegExp(k),n.test(d)&&(a=d,n=/(at|bl|iz)$/,o=new RegExp("([^aeiouylsz])\\1$"),p=new RegExp("^"+f+e+"[^aeiouwxy]$"),n.test(a)?a+="e":o.test(a)?(m=/.$/,a=a.replace(m,"")):p.test(a)&&(a+="e"))}if(m=new RegExp("^(.*"+e+".*)y$"),m.test(a)){var q=m.exec(a);d=q[1],a=d+"i"}if(m=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,m.test(a)){var q=m.exec(a);d=q[1],g=q[2],m=new RegExp(h),m.test(d)&&(a=d+b[g])}if(m=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,m.test(a)){var q=m.exec(a);d=q[1],g=q[2],m=new RegExp(h),m.test(d)&&(a=d+c[g])}if(m=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,n=/^(.+?)(s|t)(ion)$/,m.test(a)){var q=m.exec(a);d=q[1],m=new RegExp(j),m.test(d)&&(a=d)}else if(n.test(a)){var q=n.exec(a);d=q[1]+q[2],n=new RegExp(j),n.test(d)&&(a=d)}if(m=/^(.+?)e$/,m.test(a)){var q=m.exec(a);d=q[1],m=new RegExp(j),n=new RegExp(i),o=new RegExp("^"+f+e+"[^aeiouwxy]$"),(m.test(d)||n.test(d)&&!o.test(d))&&(a=d)}return m=/ll$/,n=new RegExp(j),m.test(a)&&n.test(a)&&(m=/.$/,a=a.replace(m,"")),"y"==l&&(a=l.toLowerCase()+a.substr(1)),a}}(b=a.Porter||(a.Porter={}))}(b=a.Stemmers||(a.Stemmers={}))}(Reflex||(Reflex={}));var Reflex;!function(a){function b(){return{}}function c(a,b){return b>a?-1:a>b?1:0}function d(a,b,c,d,e,f,g,h,i){if(a.length>0)for(;;){var j=d+e>>1,k=i(b,a[j]);if(0>k){if(e=j-1,d>e)return f(a,j)}else{if(!(k>0))return h(a,j);if(d=j+1,d>e)return g(a,j)}}return c}function e(a,b,c,e){return d(a,b,c,0,a.length-1,function(a,b){return a[b]},function(a,b){return b+1<a.length?a[b+1]:c},function(a,b){return b+1<a.length?a[b+1]:c},e)}var f=function(){function d(b){this.documentsCount=0,this.documents={},this.documentsByVersion={},this.insertPipeline=b.insertPipeline,this.searchPipeline=b.searchPipeline,this.corpus=new a.AvlTree(c)}return d.prototype.add=function(a,c,d){for(var e=this.documentsCount++,f=d,g=this.insertPipeline,h=g.length,i=0;h>i;i++)f=g[i](f);for(var j=this.corpus,h=f.length,k={},l=0,i=0;h>i;i++){var m=f[i],n=j.getOrAddLazy(m,b),o=n[m];o||(o=n[m]={value:m,positions:{},positionsCount:0}),k[m]||(l++,k[m]=o);var p=o.positions,q=p[e];q||(o.positionsCount++,q=p[e]=[]),q.push(i);for(var r=m.length,s=1;r>s;s++)j.getOrAddLazy(m.substring(s),b)[m]=o}var t=0;for(m in k){var u=k[m].positions[e].length;t+=u*u}t=Math.sqrt(t);var v={$did:e,$norm:t,$value:d,$terms:k,$termsCount:l,$vid:c,$reference:a};return this.documents[e]=v,(this.documentsByVersion[c]||(this.documentsByVersion[c]={}))[e]=v,v},d.prototype.intersect=function(a,b,d){for(var f=a,g=this.documents,h=this.insertPipeline,i=h.length,j=0;i>j;j++)f=h[j](f);for(var k,l,m,n=this.corpus,i=f.length,o=[],p={},q=[],r=[],s={},t=0,u=b?function(a){if(!(a.key.lastIndexOf(k,0)>-1))return!0;var c=a.value;for(var d in c){var e=c[d],f=e.positions;l[d]||(l[d]=e,m++),p[d]=(p[d]||0)+1;for(var h in f){var i=g[h],j=b[i.$vid];j&&(s[h]||(s[h]=g[h],t++))}}}:function(a){if(!(a.key.lastIndexOf(k,0)>-1))return!0;var b=a.value;for(var c in b){var d=b[c],e=d.positions;l[c]||(l[c]=d,m++),p[c]=(p[c]||0)+1;for(var f in e){{g[f]}s[f]||(s[f]=g[f],t++)}}},j=0;i>j;j++){var k=f[j],l={},m=0,s={},t=0;n.iterateForward(n.findCurrOrNext(k),u),o.push(l),q.push(m),r.push({hash:s,capacity:t})}var v=0;for(var w in p){var x=p[w];v+=x*x}v=Math.sqrt(v);for(var w in p)p[w]/=v;if(r.sort(function(a,b){return a.capacity-b.capacity}),i>1)for(var y,z,A=r[0].hash,j=1;i>j;j++){y={},z=0;var B=r[j].hash;for(var C in A)B[C]&&(z++,y[C]=B[C]);A=y}else{if(!(i>0))return[];var y=r[0].hash,z=r[0].capacity,A=y}for(var C in y){for(var D=0,E=-1/0,F=this.documentsCount,G=y[C],H=G.$did,I=G.$norm,J=G.$terms,K=G.$termsCount,L=!0,j=0;i>j;j++){var l=o[j],M=1/0,N=!1,O=[];if(q[j]<K)for(var w in l){var P=J[w];P&&O.push(P)}else for(var w in J){var P=l[w];P&&O.push(P)}for(var Q=O.length,R=0;Q>R&&0!==M&&M!==E;R++){var P=O[R],S=P.positions[H];D+=S.length/I*Math.log(1+F/P.positionsCount)*p[P.value];var T=e(S,E,null,c);null!==T&&M>T&&(M=T,N=!0)}if(!N){L=!1;break}E=M}if(L){var U=d(D,G);if(void 0!==U)return U}}return void 0},d.prototype.remove=function(a){var b=this.corpus,c=this.documentsByVersion[a];for(var d in c){var e,f=c[d],g=f.$terms;for(e in g){var h=g[e],i=h.positions;if(!delete i[d])throw new Error("Positions collection didn't contain the searched $did, this is a sign of bug in Reflex, please contact Reflex dev team via creating an issue on Refliex github page");if(--h.positionsCount<1)for(var j=e.length,k=0;j>k;k++){var l=e.substring(k),m=b.find(l).value;if(!m)throw new Error("Part wasn't found in corpus, however it should have existed, this is a sign of data corruption or bug in Reflex, please contact Reflex dev team via creating an issue on Refliex github page");if(!delete m[e])throw new Error("A term dictionary hashed by token didn't contain current token, however it should have existed, this is a sign of data corruption or bug in Reflex, please contact Reflex dev team via creating an issue on Refliex github page");var n=!0;for(var o in m){n=!1;break}if(n&&!b.remove(l))throw new Error("Was unable to remove part from the corpus, this is a sign of data corruption or bug in Reflex, please contact Reflex dev team via creating an issue on Refliex github page")}}}if(!delete this.documentsByVersion[a])throw new Error("Was unable to remove version from documentsByVersion, this is a sign of bug in Reflex, please contact Reflex dev team via creating an issue on Refliex github page")},d}();a.Index=f}(Reflex||(Reflex={}));var Reflex;!function(a){"use strict";function b(a,b,c){if("[object Function]"!==k.call(b))throw new TypeError("iterator must be a function");var d,e,f=a.length;if(f===+f){for(d=0;f>d;d+=1)if(e=b.call(c,a[d],d,a),void 0!==e)return e}else for(d in a)if(l.call(a,d)&&(e=b.call(c,a[d],d,a),void 0!==e))return e}function c(a){throw new Error(a)}function d(){throw new Error("A pure abstract call was issued")}function e(a){throw new Error(a?'Argument "'+a+'" was not defined':"Argument not defined")}function f(){c("Invalid operation")}var g=[];!function(a){a[a.Atom=0]="Atom",a[a.Hash=1]="Hash",a[a.Array=2]="Array",a[a.Reference=3]="Reference"}(a.Type||(a.Type={}));var h=a.Type,i=function(){function a(a,b,c,d){this.$vid=a,this.$cid=b,this.$rid=c,this.$=d}return a}();a.Version=i;var j=function(a){for(var b in a)return!1;return!0},k=Object.prototype.toString,l=Object.prototype.hasOwnProperty,m=function(){function a(a,b,c){this.repo=a,this.$rid=b,this.table=c,this.owners={},this.versions={}}return a}();a.Reference=m;var n=function(){function a(a,b,c,d){this.repo=a,this.tableDescriptor=b,this.propertyDescriptor=c,this.type=d}return a.fromRecord=function(b,d,f,g,i){if(g){var j,k;switch(g.type?g.type.name?(j=g.type.name,k=g.type.index||d.repo.defaultIndexConfiguration):(j=g.type,k=g.index||d.repo.defaultIndexConfiguration):(j=g,k=d.repo.defaultIndexConfiguration),j){case h[0]:return new s(b,d,f,d.repo.indexConfigurations[k]||c('Index configuration "'+k+'" not found'));case h[1]:return new q(b,d,f,a.fromRecord(b,d,f,g.of,i));case h[2]:return new p(b,d,f,a.fromRecord(b,d,f,g.of,i));case h[3]:return new t(b,d,f,i(g.of));default:return new t(b,d,f,i(j))}}else e("typeDeclaration")},a.prototype.index=function(){d()},a.prototype.deindex=function(){d()},a.prototype.intersect=function(){return d()},a.prototype.recursiveSearchToken=function(){return d()},a.prototype.export=function(){return d()},a.prototype.import=function(){return d()},a}();a.TypeDescriptor=n;var o=function(a){function b(c,d,e,f,g){if(a.call(this,c,d,e,f),this.of=g,g instanceof b)this.baseType=g.baseType;else{if(!(g instanceof r))throw new Error("Unexpected descriptor type");this.baseType=g}}return __extends(b,a),b.prototype.intersect=function(a,b,c){return this.of.intersect(a,b,c)},b.prototype.recursiveSearchToken=function(a,b){return this.of.recursiveSearchToken(a,b)},b.prototype.reference=function(){return d()},b.prototype.checkout=function(){return d()},b.prototype.clone=function(){return d()},b.prototype.contains=function(){return d()},b.prototype.changed=function(){return d()},b.prototype.dereference=function(){return d()},b.prototype.cleanup=function(){return d()},b}(n);a.CollectionDescriptor=o;var p=function(a){function b(b,d,e,f){a.call(this,b,d,e,2,f),f instanceof r?(this.reference=this.referenceTerminal,this.checkout=this.checkoutTerminal,this.cleanup=this.cleanupTerminal,this.clone=this.cloneTerminal,f instanceof s?(this.changed=this.changedTerminalAtom,this.contains=this.containsTerminalAtom,this.dereference=this.dereferenceTerminalAtom):f instanceof t?(this.changed=this.changedTerminalReference,this.contains=this.containsTerminalReference,this.dereference=this.dereferenceTerminalReference):c("Unexpected descriptor type")):(this.dereference=this.dereferenceCollection,this.reference=this.referenceCollection,this.checkout=this.checkoutCollection,this.contains=this.containsCollection,this.cleanup=this.cleanupCollection,this.changed=this.changedCollection,this.clone=this.cloneCollection)}return __extends(b,a),b.prototype.export=function(a,b){if(a){var c=this.of;b=b||[],b.length=a.length;for(var d=a.length,e=0;d>e;e++)b[e]=c.export(a[e],b[e]);return b}return a},b.prototype.import=function(a,b){if(b){var c=this.of;a=a||[],a.length=b.length;for(var d=b.length,e=0;d>e;e++)a[e]=c.import(a[e],b[e]);return a}return b},b.prototype.index=function(a,b,c){for(var d=this.of,e=c.length,f=0;e>f;f++){var g=c[f];g&&d.index(a,b,g)}},b.prototype.cleanupTerminal=function(a,b,c){for(var d=this.propertyDescriptor.name,e=c.length,f=b.table,g=b.vid,h=0;e>h;h++){var i=c[h];if(i){var k=i.owners[f];if(k){var l=k[d];l?(delete l[g],j(l)&&(delete k[d],j(k)&&delete i.owners[f])):j(k)&&delete i.owners[f]}}}},b.prototype.cleanupCollection=function(a,b,c){for(var d=this.of,e=c.length,f=0;e>f;f++){var g=c[f];g&&d.cleanup(a,b,g)}},b.prototype.referenceTerminal=function(a,b,c,d){for(var e=d.length,f=b.vid,g=b.table,h=this.of.of.name,i=this.propertyDescriptor.name,j=0;e>j;j++){var k=d[j];if(k){var l=d[j]=a[k]||(a[k]=new m(this.repo,k,h)),n=l.owners[g]||(l.owners[g]={}),o=n[i]||(n[i]={});o[f]=c}}},b.prototype.referenceCollection=function(a,b,c,d){for(var e=this.of,f=d.length,g=0;f>g;g++){var h=d[g];h&&e.reference(a,b,c,h)}},b.prototype.checkoutCollection=function(a,b,c,d){for(var e=this.of,f=b.length,g=0;f>g;g++){var h=b[g];h&&e.checkout(a,h,c,d)}},b.prototype.checkoutTerminal=function(a,b,c,d){for(var e=b.length,f=0;e>f;f++){var g=b[f];if(g){var h=g.versions;for(var i in h)i in c||(d.push(a[i]),c[i]=h[i])}}},b.prototype.cloneCollection=function(a){for(var b=this.of,c=[],d=c.length=a.length,e=0;d>e;e++){var f=a[e];c[e]=f?b.clone(f):f}return c},b.prototype.cloneTerminal=function(a){for(var b=[],c=b.length=a.length,d=0;c>d;d++)b[d]=a[d];return b},b.prototype.changedCollection=function(a,b){var c=this.of;if(a.length!==b.length)return!0;for(var d=b.length,e=0;d>e;e++){var f=a[e],g=b[e];if(f&&g){if(c.changed(f,g))return!0}else if(f||g||f!==g)return!0}return!1},b.prototype.changedTerminalAtom=function(a,b){if(a.length!==b.length)return!0;for(var c=b.length,d=0;c>d;d++)if(a[d]!==b[d])return!0;return!1},b.prototype.changedTerminalReference=function(a,b){if(a.length!==b.length)return!0;for(var c=b.length,d=0;c>d;d++){var e=a[d],f=b[d];if(e&&f){if(e.$rid!==f)return!0}else if(e||f||e!==f)return!0}return!1},b.prototype.containsCollection=function(a,b,c){for(var d=this.of,e=a.length,f=0;e>f;f++){var g=a[f];if(g&&d.contains(g,b,c))return!0}return!1},b.prototype.containsTerminalAtom=function(a,b){for(var c=(this.of,a.length),d=0;c>d;d++){var e=a[d];if(e&&b(e))return!0}return!1},b.prototype.containsTerminalReference=function(a,b,c){for(var d=this.of.of,e=a.length,f=0;e>f;f++){var g=a[f];if(g&&d.contains(g,b,c))return!0}return!1},b.prototype.dereferenceCollection=function(a){for(var b=this.of,c=[],d=c.length=a.length,e=0;d>e;e++){var f=a[e];c[e]=f?b.dereference(f):f}return c},b.prototype.dereferenceTerminalAtom=function(a){for(var b=[],c=b.length=a.length,d=0;c>d;d++)b[d]=a[d];return b},b.prototype.dereferenceTerminalReference=function(a){for(var b=[],c=b.length=a.length,d=0;c>d;d++){var e=a[d];b[d]=e?e.$rid:e}return b},b}(o);a.ArrayDescriptor=p;var q=function(a){function b(b,d,e,f){a.call(this,b,d,e,1,f),f instanceof r?(this.reference=this.referenceTerminal,this.checkout=this.checkoutTerminal,this.cleanup=this.cleanupTerminal,this.clone=this.cloneTerminal,f instanceof s?(this.changed=this.changedTerminalAtom,this.contains=this.containsTerminalAtom,this.dereference=this.dereferenceTerminalAtom):f instanceof t?(this.changed=this.changedTerminalReference,this.contains=this.containsTerminalReference,this.dereference=this.dereferenceTerminalReference):c("Unexpected descriptor type")):(this.dereference=this.dereferenceCollection,this.reference=this.referenceCollection,this.checkout=this.checkoutCollection,this.contains=this.containsCollection,this.cleanup=this.cleanupCollection,this.changed=this.changedCollection,this.clone=this.cloneCollection)}return __extends(b,a),b.prototype.export=function(a,b){if(a){var c=this.of;b=b||{};for(var d in a)b[d]=c.export(a[d],b[d]);return b}return a},b.prototype.import=function(a,b){if(b){var c=this.of;a=a||{};for(var d in b)a[d]=c.import(a[d],b[d]);return a}return b},b.prototype.index=function(a,b,c){var d=this.of;for(var e in c){var f=c[e];f&&d.index(a,b,f)}},b.prototype.cleanupTerminal=function(a,b,c){var d=this.propertyDescriptor.name,e=b.vid,f=b.table;for(var g in c){var h=c[g];if(h){var i=h.owners[f];if(i){var k=i[d];k?(delete k[e],j(k)&&(delete i[d],j(i)&&delete h.owners[f])):j(i)&&delete h.owners[f]}}}},b.prototype.cleanupCollection=function(a,b,c){var d=this.of;for(var e in c){var f=c[e];f&&d.cleanup(a,b,f)}},b.prototype.referenceTerminal=function(a,b,c,d){var e=b.vid,f=b.table,g=this.of.of.name,h=this.propertyDescriptor.name;for(var i in d){var j=d[i];if(j){var k=d[i]=a[j]||(a[j]=new m(this.repo,j,g)),l=k.owners[f]||(k.owners[f]={}),n=l[h]||(l[h]={});n[e]=c}}},b.prototype.referenceCollection=function(a,b,c,d){var e=this.of;for(var f in d){var g=d[f];g&&e.reference(a,b,c,g)}},b.prototype.checkoutCollection=function(a,b,c,d){var e=this.of;for(var f in b){var g=b[f];g&&e.checkout(a,g,c,d)}},b.prototype.checkoutTerminal=function(a,b,c,d){for(var e in b){var f=b[e];if(f){var g=f.versions;for(var h in g)h in c||(d.push(a[h]),c[h]=g[h])}}},b.prototype.cloneCollection=function(a){var b=this.of,c={};for(var d in a){var e=a[d];c[d]=e?b.clone(e):e}return c},b.prototype.cloneTerminal=function(a){var b={};for(var c in a)b[c]=a[c];return b},b.prototype.changedCollection=function(a,b){var c=this.of;for(var d in b){if(!(d in a))return!0;var e=a[d],f=b[d];if(e&&f){if(c.changed(a[d],b[d]))return!0}else if(e||f||e!==f)return!0}for(var d in a)if(!(d in b))return!0;return!1},b.prototype.changedTerminalAtom=function(a,b){for(var c in b){if(!(c in a))return!0;if(a[c]!==b[c])return!0}for(var c in a)if(!(c in b))return!0;return!1},b.prototype.changedTerminalReference=function(a,b){for(var c in b){if(!(c in a))return!0;var d=a[c],e=b[c];if(d&&e){if(a[c].$rid!==b[c])return!0}else if(d||e||d!==e)return!0}for(var c in a)if(!(c in b))return!0;return!1},b.prototype.containsCollection=function(a,b,c){var d=this.of;for(var e in f){var f=a[e];if(f&&d.contains(f,b,c))return!0}return!1},b.prototype.containsTerminalAtom=function(a,b){for(var c in a){var d=a[c];if(d&&b(d))return!0}return!1},b.prototype.containsTerminalReference=function(a,b,c){var d=this.of.of;for(var e in a){var f=a[e];if(f&&d.contains(f,b,c))return!0}return!1},b.prototype.dereferenceCollection=function(a){var b=this.of,c={};for(var d in a){var e=a[d];c[d]=e?b.dereference(e):e}return c},b.prototype.dereferenceTerminalAtom=function(a){var b={};for(var c in a)b[c]=a[c];return b},b.prototype.dereferenceTerminalReference=function(a){var b={};for(var c in a){var d=a[c];b[c]=d?d.$rid:d}return b},b}(o);a.HashDescriptor=q;var r=function(a){function b(b,c,d,e){a.call(this,b,c,d,e)}return __extends(b,a),b}(n);a.TerminalDescriptor=r;var s=function(b){function c(c,d,e,f){b.call(this,c,d,e,0),this._index=new a.Index(f)}return __extends(c,b),c.prototype.export=function(a){if(a){var b=k.call(a);if("[object Object]"===b||"[object Array]"===b)return JSON.parse(JSON.stringify(a))}return a},c.prototype.import=function(a,b){if(b){var c=k.call(a);if("[object Object]"===c||"[object Array]"===c)return JSON.parse(JSON.stringify(b))}return b},c.prototype.index=function(a,b,c){this._index.add(a,b,c)},c.prototype.deindex=function(a){this._index.remove(a)},c.prototype.intersect=function(a,b,c){return this._index.intersect(a,b,function(a,b){return c({score:a,value:b.$value,$vid:b.$vid,reference:b.$reference})})},c}(r);a.AtomDescriptor=s;var t=function(a){function b(b,c,d,e){a.call(this,b,c,d,3),this.of=e}return __extends(b,a),b.prototype.recursiveSearchToken=function(a,b){return this.of.recursiveSearchToken(a,b)},b.prototype.export=function(a){return a?a.$rid:a},b.prototype.import=function(a,b){if(b){var d=this.repo,e=this.of,f=e.name,g=b instanceof m?b.$rid:b;return d.tables[f][g]||c('Reference "'+g+'" not found')}return b},b}(r);a.ReferenceDescriptor=t;var u=function(){function a(a,b,c,d,e){this.repo=a,this.parent=b,this.name=c,this.typeDescriptor=n.fromRecord(a,b,this,d,e)}return a.prototype.index=function(a,b,c){this.typeDescriptor.index(a,b,c)},a.prototype.deindex=function(a){this.typeDescriptor.deindex(a)},a.prototype.intersect=function(a,b,c){return this.typeDescriptor.intersect(a,b,c)},a.prototype.export=function(a,b){return this.typeDescriptor.export(a,b)},a.prototype.import=function(a,b){return this.typeDescriptor.import(a,b)},a}();a.PropertyDescriptor=u;var v=function(){function a(a,b,c){this.repo=a,this.name=b,this.declaration=c,this.properties={},this.propertiesArray=[],this.atomProperties=[],this.referenceProperties=[],this.flatProperties=[],this.nestedProperties=[],this.hashProperties=[],this.arrayProperties=[],this.nestedAtomProperties=[],this.nestedReferenceProperties=[],this.flatAtomProperties=[],this.flatReferenceProperties=[]}return a.prototype.flatSearch=function(a){for(var b=a.match(/(?:")(?:(?:[\u00C0-\u1FFF\u2C00-\uD7FF\w]+'[\u00C0-\u1FFF\u2C00-\uD7FF\w]+|['\u00C0-\u1FFF\u2C00-\uD7FF\w]+)[^\u00C0-\u1FFF\u2C00-\uD7FF\w]*)+(?:")|(?:[\u00C0-\u1FFF\u2C00-\uD7FF\w]+'[\u00C0-\u1FFF\u2C00-\uD7FF\w]+|['\u00C0-\u1FFF\u2C00-\uD7FF\w]+)/g)||g,c=this.flatAtomProperties,d=c.length,e=0,f=null,h=(b.length,0);h<b.length;h++){for(var i=b[h],j={},e=0,k=0;d>k;k++)c[k].intersect(i,f,function(a){var b=j[a.$vid];if(b){var c=b.score;b.score+=c*c}else e++,j[b.$vid]=a,a.score*=a.score});f=j}return{count:e,results:f||{}}},a.prototype.recursiveSearchToken=function(a,b){var c=this.repo,d=this.name,e=b[d],f=0,g=c.records,h=c.references;if(!e){e=b[this.name]={};for(var i=[this.flatReferenceProperties,this.nestedReferenceProperties],j=0;j<i.length;j++)for(var k=i[j],l=k.length,m=0;m<k.length;m++){var n=k[m],o=n.name,p=n.typeDescriptor.recursiveSearchToken(a,b).results;for(var q in p){var r=p[q],s=r.reference.owners[d];if(s){var t=s[o];if(t)for(var u in t){var v=e[u];v?v.score+=r.score:(f++,e[u]={score:r.score,value:r.value,reference:h[g[u].rid],$vid:u})}}}}for(var i=[this.flatAtomProperties,this.nestedAtomProperties],j=0;j<i.length;j++)for(var k=i[j],l=k.length,m=0;l>m;m++){var n=k[m],o=n.name;n.intersect(a,null,function(a){var b=e[a.$vid];b?b.score+=a.score*a.score:(f++,e[a.$vid]=a,a.score*=a.score)})}}return{count:f,results:e}},a.prototype.recursiveSearch=function(a){var b=a.match(/(?:")(?:(?:[\u00C0-\u1FFF\u2C00-\uD7FF\w]+'[\u00C0-\u1FFF\u2C00-\uD7FF\w]+|['\u00C0-\u1FFF\u2C00-\uD7FF\w]+)[^\u00C0-\u1FFF\u2C00-\uD7FF\w]*)+(?:")|(?:[\u00C0-\u1FFF\u2C00-\uD7FF\w]+'[\u00C0-\u1FFF\u2C00-\uD7FF\w]+|['\u00C0-\u1FFF\u2C00-\uD7FF\w]+)/g)||g,c=b.length;if(c>0){for(var d=this.recursiveSearchToken(b[0],{}),e=1;e<b.length;e++){var f=this.recursiveSearchToken(b[e],{});if(d.count<f.count)var h=d.results,i=f.results;else var h=f.results,i=d.results;var j={},k=0;for(var l in h){var m=i[l];m&&(k++,j[l]=m)}d={count:k,results:j}}return d}return{count:0,results:{}}},a.prototype.initializeDeclaration=function(a,b,c,d){var e=new u(a,this,b,c,d);this.propertiesArray.push(e),this.properties[e.name]=e;var g=e.typeDescriptor;switch(g.type){case 0:this.atomProperties.push(e),this.flatProperties.push(e),this.flatAtomProperties.push(e);break;case 1:this.hashProperties.push(e),this.nestedProperties.push(e);var h=g.baseType;switch(h.type){case 0:this.atomProperties.push(e),this.nestedAtomProperties.push(e);break;case 3:this.referenceProperties.push(e),this.nestedReferenceProperties.push(e)}break;case 2:this.arrayProperties.push(e),this.nestedProperties.push(e);var h=g.baseType;switch(h.type){case 0:this.atomProperties.push(e),this.nestedAtomProperties.push(e);break;case 3:this.referenceProperties.push(e),this.nestedReferenceProperties.push(e)}break;case 3:this.flatProperties.push(e),this.flatReferenceProperties.push(e),this.referenceProperties.push(e);break;default:f()}},a.prototype.initialize=function(a){var b=this.declaration;for(var c in b)this.initializeDeclaration(this.repo,c,b[c],a)},a.prototype.reference=function(a,b,c){for(var d=b.rid,e=b.vid,f=b.table,g=a[d],h=this.flatAtomProperties,i=h.length,j=0;i>j;j++){var k=h[j],l=c[k.name];null!==l&&void 0!==l&&k.index(g,e,l)}for(var h=this.flatReferenceProperties,i=h.length,j=0;i>j;j++){var k=h[j],n=k.name,o=c[k.name];if(o){var g=c[n]=a[o]||(a[o]=new m(this.repo,o,k.typeDescriptor.of.name)),p=g.owners[f]||(g.owners[f]={}),q=p[n]||(p[n]={});q[e]=c}}for(var h=this.nestedReferenceProperties,i=h.length,j=0;i>j;j++){var k=h[j],r=c[k.name];r&&k.typeDescriptor.reference(a,b,c,r)}},a.prototype.cleanup=function(a,b,c){var d=b.vid,e=b.table;m=this.flatReferenceProperties,n=m.length;for(var f=0;n>f;f++){var g=m[f],h=g.name,i=c[g.name];if(i){var k=i.owners[e];if(k){var l=k[h];l?(delete l[d],j(l)&&(delete k[h],j(k)&&delete i.owners[e])):j(k)&&delete i.owners[e]}}}for(var m=this.nestedReferenceProperties,n=m.length,f=0;n>f;f++){var g=m[f],o=c[g.name];o&&g.typeDescriptor.cleanup(a,b,o)}for(var m=this.flatAtomProperties,n=m.length,f=0;n>f;f++){var g=m[f];g.deindex(d)}},a.prototype.checkout=function(a,b,c,d){for(var e=this.flatReferenceProperties,f=e.length,g=0;f>g;g++){var h=e[g],i=b[h.name];if(i){var j=i.versions;for(var k in j)k in c||(d.push(a[k]),c[k]=j[k])}}for(var e=this.nestedReferenceProperties,f=e.length,g=0;f>g;g++){var h=e[g],i=b[h.name];i&&h.typeDescriptor.checkout(a,i,c,d)}},a.prototype.contains=function(a,b,c){if(a&&!(a.$rid in c)){var d=a.versions;c[a.$rid]=null;for(var e in d){for(var f=d[e],g=this.flatAtomProperties,h=g.length,i=0;h>i;i++){var j=g[i],k=j.name;if(k in f&&b(f[k]))return c[a.$rid]=!0}g=this.flatReferenceProperties,h=g.length;for(var i=0;h>i;i++){var j=g[i],k=j.name;if(k in f&&j.typeDescriptor.of.contains(f[k],b,c))return c[a.$rid]=!0}g=this.nestedProperties,h=g.length;for(var i=0;h>i;i++){var j=g[i],k=j.name;if(k in f&&j.typeDescriptor.contains(f[k],b,c))return c[a.$rid]=!0}}}return c[a.$rid]=!1},a.prototype.clone=function(a,b){for(var c=a.proto,d=new i(a.vid,a.cid,b.$rid,b),e=this.flatProperties,f=e.length,g=0;f>g;g++){var h=e[g],j=h.name;j in c&&(d[j]=c[j])}for(var e=this.nestedProperties,f=e.length,g=0;f>g;g++){var h=e[g],j=h.name;if(j in c){var k=c[j];d[j]=k?h.typeDescriptor.clone(k):k}}return d},a.prototype.changed=function(a,b){for(var c=this.flatAtomProperties,d=c.length,e=0;d>e;e++){var f=c[e],g=f.name;if(g in b!=g in a||b[g]!==a[g])return!0}for(var c=this.flatReferenceProperties,d=c.length,e=0;d>e;e++){var f=c[e],g=f.name,h=g in a,i=g in b;if(h&&i){var j=a[g];if(j){if(a[g].$rid!==b[g])return!0}else if(j!==b[g])return!0}else if(h||i)return!0}for(var c=this.nestedProperties,d=c.length,e=0;d>e;e++){var f=c[e],g=f.name,h=g in a,i=g in b;if(h&&i){var j=a[g],k=b[g];if(j&&k){if(f.typeDescriptor.changed(j,k))return!0}else if(j||k||j!==k)return!0}else if(h||i)return!0}return!1},a.prototype.dereference=function(a){for(var b={},c=this.flatAtomProperties,d=c.length,e=0;d>e;e++){var f=c[e],g=f.name;g in a&&(b[g]=a[g])}for(var c=this.flatReferenceProperties,d=c.length,e=0;d>e;e++){var f=c[e],g=f.name;if(g in a){var h=a[g];b[g]=h?h.$rid:h}}for(var c=this.nestedProperties,d=c.length,e=0;d>e;e++){var f=c[e],g=f.name;if(g in a){var i=a[g];b[g]=i?f.typeDescriptor.dereference(i):i}}return b},a}();a.TableDescriptor=v;var w=function(){function a(){}return a.defaultStopWordsFilter=function(a){return function(b){for(var c=b.length,d=0,e=0;c>d;d++){var f=b[d];f in a||(b[e++]=f)}return b.length=e,b}},a.defaultTokenizer=function(a){return function(b){return String(b).toLowerCase().match(a)||g}},a.defaultStemmer=function(a){return function(b){for(var c=b.length,d=0;c>d;d++)b[d]=a(b[d]);return b}},a.defaultStopWords=function(a){for(var b={},c=0;c<a.length;++c)b[a[c]]=!0;
return b}(["a","about","above","across","after","afterwards","again","against","all","almost","alone","along","already","also","although","always","am","among","amongst","amoungst","amount","an","and","another","any","anyhow","anyone","anything","anyway","anywhere","are","around","as","at","back","be","became","because","become","becomes","becoming","been","before","beforehand","behind","being","below","beside","besides","between","beyond","bill","both","bottom","but","by","call","can","cannot","cant","co","con","could","couldnt","cry","de","describe","detail","do","done","down","due","during","each","eg","eight","either","eleven","else","elsewhere","empty","enough","etc","even","ever","every","everyone","everything","everywhere","except","few","fifteen","fify","fill","find","fire","first","five","for","former","formerly","forty","found","four","from","front","full","further","get","give","go","had","has","hasnt","have","he","hence","her","here","hereafter","hereby","herein","hereupon","hers","herself","him","himself","his","how","however","hundred","ie","if","in","inc","indeed","interest","into","is","it","its","itself","keep","last","latter","latterly","least","less","ltd","made","many","may","me","meanwhile","might","mill","mine","more","moreover","most","mostly","move","much","must","my","myself","name","namely","neither","never","nevertheless","next","nine","no","nobody","none","noone","nor","not","nothing","now","nowhere","of","off","often","on","once","one","only","onto","or","other","others","otherwise","our","ours","ourselves","out","over","own","part","per","perhaps","please","put","rather","re","same","see","seem","seemed","seeming","seems","serious","several","she","should","show","side","since","sincere","six","sixty","so","some","somehow","someone","something","sometime","sometimes","somewhere","still","such","system","take","ten","than","that","their","them","themselves","then","thence","there","thereafter","thereby","therefore","therein","thereupon","these","they","thickv","thin","third","this","those","though","three","through","throughout","thru","thus","to","together","too","top","toward","towards","twelve","twenty","two","un","under","until","up","upon","us","very","via","was","we","well","were","what","whatever","when","whence","whenever","where","whereafter","whereas","whereby","wherein","whereupon","wherever","whether","which","while","whither","who","whoever","whole","whom","whose","why","will","with","within","without","would","yet","you","your","yours","yourself","yourselves","the"]),a.defaultTokenizerRegexp=/[\u00C0-\u1FFF\u2C00-\uD7FF\w]+'[\u00C0-\u1FFF\u2C00-\uD7FF\w]+|['\u00C0-\u1FFF\u2C00-\uD7FF\w]+/gi,a}();a.Pipeline=w;var x=function(){function a(a,b,c){this.defaultIndexConfiguration=b,this.indexConfigurations=c;var d=this;d.indexConfigurations=d.indexConfigurations||{},d.defaultIndexConfiguration=d.defaultIndexConfiguration||"default",d.indexConfigurations[d.defaultIndexConfiguration]=d.indexConfigurations[d.defaultIndexConfiguration]||function(){return{insertPipeline:[w.defaultTokenizer(w.defaultTokenizerRegexp)],searchPipeline:[w.defaultTokenizer(w.defaultTokenizerRegexp)]}}(),d.tables={},d.records={},d.creates={},d.deletes={},d.versions={},d.references={},d.tableChanged={},d.tableChanging={},d.referenceChanged={},d.referenceChanging={},a&&d.migrate(a)}return a.prototype.search=function(a,b,c){var d;if(arguments.length)if(1===arguments.length){var e=0,f={},g=this.descriptors;for(var h in g){var i=g[h],j=i.recursiveSearch(a).results;for(var k in j){var l=j[k],m=f[k];m?m.score+=l.score:(e++,f[k]=l)}}d={count:e,results:f}}else if(2===arguments.length)d=this.descriptors[b].recursiveSearch(a);else{var e=0,f={},n=this.descriptors[b].properties[c],p=n.typeDescriptor,q=p instanceof o?p.baseType:p;0===q.type?n.intersect(a,null,function(a){e++,f[a.$vid]=a}):3===q.type&&(d=q.of.recursiveSearch(a)),d={count:e,results:f}}else d={count:0,results:{}};var r=0,s=[],t=d.results;s.length=d.count;for(var u in t)s[r++]=t[u];return s.sort(function(a,b){return b.score-a.score}),s},a.prototype.find=function(a,b,c,d,e){if(a){var f=this.descriptor(b);if(e=e||{},"[object Array]"===k.call(a))for(var g=a.length,h=0;g>h;h++){var i=a[h];d(i,f.contains(i,c,e))}else for(var j in a){var i=a[j];d(i,f.contains(i,c,e))}}},a.prototype.descriptor=function(a){return this.descriptors[a]||c('Descriptor "'+a+'" not found')},a.prototype.checkout=function(){var a={},d=[],e=this.records,f=this.references,g=this.descriptors,h=function(b){var c=b.versions;for(var f in c)f in a||(d.push(e[f]),a[f]=c[f])},j=function(){b(arguments,function(g){if(g instanceof m)h(g);else if(g instanceof i){var l=g.$vid;l in a||(d.push(e[l]),a[l]=g)}else if("string"==typeof g||g instanceof String)if(g in e){if(!(g in a)){var n=e[g];d.push(n),a[g]=f[n.rid].versions[n.vid]}}else g in f?h(f[g]):c('Id "'+g+'" not found');else"[object Array]"===k.call(g)?j.apply(this,g):"[object Object]"===k.call(g)?b(g,function(a){j.call(this,a)}):c("Unexpected argument type")})};j.apply(this,arguments);for(var l=0;l<d.length;l++){var n=d[l];g[n.table].checkout(e,a[n.vid],a,d)}return d},a.prototype.diff=function(){var a=this.creates,b=this.deletes,c=this.records,d=this.references,e=this.descriptors,f=[];for(var g in c){var h=c[g],i=d[h.rid],j=i.versions,k=h.table,l=g in a,m=g in b;l&&m||!(l||m||e[k].changed(j[g],h.proto))||f.push(m?{rid:h.rid,vid:l?null:h.vid,table:h.table,pid:h.pid,createdOn:h.createdOn,updatedOn:h.updatedOn}:{cid:h.cid,rid:h.rid,vid:l?null:h.vid,table:h.table,pid:h.pid,proto:e[h.table].dereference(j[g]),createdOn:h.createdOn,updatedOn:h.updatedOn,recoveredOn:h.recoveredOn})}return f},a.fireTableEvents=function(a,b){var c=a.name,d=b[c];if(d)for(var e=d.length,f=0;e>f;f++)d[f](c,a)},a.prototype.merge=function(b){for(var d=this.tables,e=this.records,f=this.versions,g=this.references,h=this.descriptors,i=this.tableChanged,k=this.tableChanging,l=this.referenceChanged,n=this.referenceChanging,o={},p={},q=b.length,r=0;q>r;r++){var s=b[r],t=s.rid,u=s.table,v=g[t],w=h[u];if(w){u in o||a.fireTableEvents(o[u]=w,k);var x=n[t];if(x)for(var y=x.length,z=0;y>z;z++)x[z](t,v,w,s);if(s.proto){var A=s.vid,v=g[t];v?v.versions[A]=w.clone(s,v):(v=d[u][t]=g[t]=new m(this,t,s.table),f[A]=v.versions[A]=w.clone(s,v)),e[A]=s}t in l&&(p[t]=w)}else c('Table "'+u+'" not found')}for(var r=0;q>r;r++){var s=b[r];if(s.proto)h[s.table].reference(g,s,g[s.rid].versions[s.vid]);else{var s=b[r],t=s.rid,A=s.vid;delete e[A];var v=g[t];if(v){var B=v.versions[A];delete f[A],delete v.versions[A],j(v.owners)&&j(v.versions)&&(delete g[t],delete d[s.table][t]),h[s.table].cleanup(g,s,B)}}}for(var C in p)for(var w=p[C],D=l[C],E=D.length,r=0;E>r;r++)D[r](C,g[C],w);for(var C in o)a.fireTableEvents(o[C],i)},a.prototype.migrate=function(a){var b=this,d=this.descriptors={},e={},f=function(d){for(var g=d;"[object String]"===k.call(g);)g=a[g]||c('Descriptor "'+g+'" not found'),g===d&&c('Recursive type declaration of type "'+d+'"');if(d in e)return e[d];var h=e[d]=new v(b,d,g);return h.initialize(f),h};for(var g in a)d[g]=f(g);var h=this.tables;for(var g in a)h[g]=h[g]||{};this.declarations=a},a.prototype.createVersion=function(a,b,d,e){if(a){var f=(new Date).getTime(),g=(this.records[b]={vid:b,rid:a.$rid,table:a.table,pid:d,proto:null,createdOn:f,updatedOn:f},this.creates[b]=a.versions[b]=new i(b,b,a.$rid,a));return this.import(a.table,g,e),g}return c('Argument "reference" is empty')},a.prototype.createReference=function(a,b){return b in this.descriptors?this.references[a]||(this.references[a]=new m(this,a,b)):c('Table name "'+b+'" not found')},a.prototype.remove=function(a){var b;if(a instanceof m){var d=a.versions;for(b in d)this.deletes[b]=d[b],delete d[b];return a}if(a instanceof i){var e=a.$,d=e.versions;return b=a.$vid,this.deletes[b]=d[b],delete d[b],a}if(a in this.records){var f=this.records[a],e=this.references[f.rid],d=e.versions,g=d[a];return this.deletes[a]=g,delete d[a],g}if(a in this.references){var e=this.references[a],d=e.versions;for(b in d)this.deletes[b]=d[b],delete d[b];return e}c('Value "'+a+'" not found in repository')},a.prototype.unremove=function(a){if(a in this.records){var b=this.records[a],d=this.references[b.rid],e=d.versions;e[a]=this.deletes[a],delete this.deletes[a]}else c('Version "'+a+'" not found')},a.prototype.on=function(a,b,c){var d,e,f,g,h="[object String]"==k.call(a)?this[a]:a;switch(k.call(b)){case"[object Array]":for(g=b,f=g.length,d=0;f>d;d++)b=g[d],"[object String]"===k.call(b)?(h[b]||(h[b]=[])).push(c):(b=b.$rid,(h[b]||(h[b]=[])).push(c));break;case"[object String]":(h[b]||(h[b]=[])).push(c);break;default:if(b instanceof m)b=b.$rid,(h[b]||(h[b]=[])).push(c);else{g=b;for(e in g)b=g[e],"[object String]"===k.call(b)?(h[b]||(h[b]=[])).push(c):(b=b.$rid,(h[b]||(h[b]=[])).push(c))}}},a.prototype.export=function(a,b,c){if(b){c=c||{};for(var d=this.descriptors[a],e=d.propertiesArray,f=e.length,g=0;f>g;g++){var h=e[g],i=h.name;i in b?c[i]=h.export(b[i],c[i]):delete c[i]}c.$vid=b.$vid}return c},a.prototype.import=function(a,b,c){if(b){c=c||{};for(var d=this.descriptors[a],e=d.propertiesArray,f=e.length,g=0;f>g;g++){var h=e[g],i=h.name;i in c?b[i]=h.import(b[i],c[i]):delete b[i]}}return b},a.prototype.clone=function(b){var c=new a(this.declarations,this.defaultIndexConfiguration,this.indexConfigurations);if(arguments.length>0){var d=this.checkout(b);c.merge(d)}return c},a}();a.Repo=x}(Reflex||(Reflex={}));